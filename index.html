<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur de Rentabilit√© pour Investissement Parking</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0284c7"/>
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/0284c7/white?text=P">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
    body {
        font-family: 'Inter', sans-serif;
    }
    .info-icon {
        cursor: help;
    }
    .info-tooltip {
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.3s;
    }
    .info-icon:hover .info-tooltip {
        visibility: visible;
        opacity: 1;
    }
    .result-card {
        transition: all 0.3s ease-in-out;
    }
    .simulation-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .sort-btn.active {
        background-color: #3b82f6; /* bg-blue-600 */
        color: white;
    }
    .highlight-year td, .highlight-year th {
        background-color: #e0f2fe; /* sky-100 */
    }

/* Positionnement de l'infobulle sur mobile */
    @media (max-width: 767px) {
        .info-tooltip {
            left: auto !important;
            right: 0 !important;
            transform: translateX(0) !important;
        }
    }

    /* Styles pour l'impression */
    @media print {
        body {
            -webkit-print-color-adjust: exact !important;
            color-adjust: exact !important;
        }
        .no-print, #auth-container, #logout-btn-container {
            display: none !important;
        }
        #app-container, body, .container {
            display: block !important;
            padding: 0;
            margin: 0;
            width: 100%;
            max-width: 100% !important;
        }
        main, #results-section > div, .bg-white {
             background-color: #ffffff !important;
             color: #000000 !important;
             box-shadow: none !important;
             border: 1px solid #e2e8f0; /* slate-200 */
             page-break-inside: avoid;
        }
        .text-slate-900, .text-slate-800, .text-slate-700, .text-slate-600, .text-slate-500,
        .text-green-900, .text-green-800, .text-red-900, .text-red-800,
        .text-blue-900, .text-blue-800, .text-blue-700 {
            color: #000000 !important;
        }
         .bg-slate-100, .bg-green-50, .bg-red-50, .bg-blue-50, .bg-slate-50 {
            background-color: #f1f5f9 !important; /* light gray for contrast */
        }
        .printable-table-container {
            max-height: none !important;
            overflow: visible !important;
        }
    }
</style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="auth-container" class="min-h-screen flex items-center justify-center">
        <div class="w-full max-w-md mx-auto p-4">
            <div class="bg-white p-8 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold text-center text-slate-900 mb-6">Acc√®s Investisseur</h2>
                <div id="auth-error" class="text-red-500 text-sm text-center mb-4 hidden"></div>
                <form id="login-form" class="space-y-4">
                    <input type="email" id="email" placeholder="Adresse e-mail" required class="w-full bg-slate-100 border-transparent rounded-lg p-3 focus:ring-blue-500 focus:border-blue-500">
                    <input type="password" id="password" placeholder="Mot de passe" required class="w-full bg-slate-100 border-transparent rounded-lg p-3 focus:ring-blue-500 focus:border-blue-500">
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-300 shadow-md">Se connecter</button>
                    <p class="text-center text-sm text-slate-600 pt-2">Pas de compte ? <a href="#" id="show-signup" class="font-semibold text-blue-600 hover:underline">Inscrivez-vous</a></p>
                </form>
                <form id="signup-form" class="space-y-4 hidden">
                     <input type="email" id="signup-email" placeholder="Adresse e-mail" required class="w-full bg-slate-100 border-transparent rounded-lg p-3 focus:ring-blue-500 focus:border-blue-500">
                    <input type="password" id="signup-password" placeholder="Mot de passe (6 car. min)" required class="w-full bg-slate-100 border-transparent rounded-lg p-3 focus:ring-blue-500 focus:border-blue-500">
                    <button type="submit" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition duration-300 shadow-md">Cr√©er un compte</button>
                     <p class="text-center text-sm text-slate-600 pt-2">D√©j√† un compte ? <a href="#" id="show-login" class="font-semibold text-blue-600 hover:underline">Connectez-vous</a></p>
                </form>
            </div>
        </div>
    </div>

    <div id="app-container" class="hidden">
        <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-5xl">
            <div id="logout-btn-container" class="text-right mb-4 no-print">
                 <button id="logout-btn" class="bg-slate-700 hover:bg-slate-800 text-white font-bold py-2 px-4 rounded-lg transition duration-300 shadow-md">D√©connexion</button>
            </div>
<div id="project-selector">
                <header class="text-center mb-12">
                    <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">Bienvenue, Investisseur !</h1>
                    <p class="text-slate-600 mt-2">Quel type de projet souhaitez-vous simuler aujourd'hui ?</p>
                </header>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <div id="select-parking" class="project-card bg-white p-8 rounded-2xl shadow-lg cursor-pointer hover:shadow-xl hover:-translate-y-1">
                        <span class="text-5xl">üöó</span>
                        <h2 class="text-2xl font-bold text-slate-800 mt-4">Parking / Garage</h2>
                        <p class="text-slate-500 mt-2">Simulez la rentabilit√© d'un ou plusieurs lots de parkings.</p>
                    </div>
                    <div id="select-logement" class="project-card bg-white p-8 rounded-2xl shadow-lg cursor-pointer hover:shadow-xl hover:-translate-y-1">
                        <span class="text-5xl">üè†</span>
                        <h2 class="text-2xl font-bold text-slate-800 mt-4">Logement</h2>
                        <p class="text-slate-500 mt-2">Analysez un investissement locatif r√©sidentiel.</p>
                    </div>
                    <div id="select-cave" class="project-card bg-white p-8 rounded-2xl shadow-lg cursor-pointer hover:shadow-xl hover:-translate-y-1">
                        <span class="text-5xl">üì¶</span>
                        <h2 class="text-2xl font-bold text-slate-800 mt-4">Cave / Box</h2>
                        <p class="text-slate-500 mt-2">Estimez le potentiel de la location d'espaces de stockage.</p>
                    </div>
                </div>
            </div>
            <header class="text-center mb-8 no-print">
                <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">Plan d'Investissement Parking</h1>
                <p class="text-slate-600 mt-2">Simulateur de rentabilit√© pour pr√©sentation bancaire.</p>
            </header>
            
<div id="project-selector">
                </div>

            <div id="simulator-container" class="hidden">
                <div id="back-to-selector-container" class="text-left mb-6 no-print">
                    <button id="back-to-selector" class="bg-slate-500 hover:bg-slate-600 text-white font-bold py-2 px-3 rounded-lg transition duration-300 shadow-md inline-flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                        Changer de projet
                    </button>
                </div>
            <div id="form-container" class="md:col-span-1 bg-white p-6 rounded-2xl shadow-lg self-start no-print">
    <div id="form-parking-wrapper" class="hidden">
                    <h2 class="text-xl font-bold mb-6 border-b pb-3">Param√®tres de l'Investissement</h2>
                    <form id="investment-form-parking" class="space-y-4">
                        
                        <template id="tooltip-template">
                            <div class="relative info-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-sky-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                                <div class="info-tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 p-3 bg-slate-800 text-white text-xs text-center rounded-lg shadow-lg pointer-events-none z-10"></div>
                            </div>
                        </template>

                        <div>
                            <div class="flex items-center justify-between">
                                <label for="city-name" class="block text-sm font-medium text-slate-700">Nom de la Ville</label>
                                <div data-tooltip="Nom de la ville o√π se situe le bien, utilis√© pour le titre de la simulation."></div>
                            </div>
                            <input type="text" id="city-name" value="Paris" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <div>
                            <div class="flex items-center justify-between">
                                <label for="announcement-link" class="block text-sm font-medium text-slate-700">Lien de l'annonce</label>
                                <div data-tooltip="Optionnel : collez ici le lien de l'annonce pour le retrouver facilement."></div>
                            </div>
                            <input type="url" id="announcement-link" placeholder="https://..." class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>

                        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">D√©tails du bien</h3>
                        <div>
                             <div class="flex items-center justify-between">
                                <label for="purchase-price" class="block text-sm font-medium text-slate-700">Prix affich√© du lot (‚Ç¨)</label>
                                <div data-tooltip="Prix de vente affich√© dans l'annonce, avant toute n√©gociation."></div>
                            </div>
                            <input type="text" id="purchase-price" value="100 000" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                         <div>
                            <div class="flex items-center justify-between">
                                <label for="negotiation-rate" class="block text-sm font-medium text-slate-700">N√©gociation sur le prix (%)</label>
                                <div data-tooltip="Pourcentage de r√©duction que vous pensez pouvoir n√©gocier sur le prix affich√©."></div>
                            </div>
                            <input type="number" id="negotiation-rate" value="5" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <div>
                            <div class="flex items-center justify-between">
                                <label for="spaces-count" class="block text-sm font-medium text-slate-700">Nombre de places</label>
                                <div data-tooltip="Nombre total de places de parking dans le lot que vous achetez."></div>
                            </div>
                            <input type="number" id="spaces-count" value="10" min="1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <div>
                             <div class="flex items-center justify-between">
                                <label for="rent-per-space" class="block text-sm font-medium text-slate-700">Loyer mensuel / place (‚Ç¨)</label>
                                <div data-tooltip="Indiquez le loyer mensuel par place, charges comprises (CC)."></div>
                            </div>
                            <input type="number" id="rent-per-space" value="70" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>

                        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Fiscalit√©</h3>
                        <div>
                            <div class="flex items-center justify-between">
                                <label for="tax-regime" class="block text-sm font-medium text-slate-700">R√©gime d'imposition</label>
                                <div data-tooltip="Micro-BIC : Abattement de 50% sur les revenus. R√©gime R√©el : D√©duction des charges r√©elles (int√©r√™ts, taxes, etc.)."></div>
                            </div>
                            <select id="tax-regime" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="none">Pas d'imposition (simulation)</option>
                                <option value="micro" selected>R√©gime Micro-BIC</option>
                                <option value="reel">R√©gime R√©el</option>
                            </select>
                        </div>
                        <div>
                            <div class="flex items-center justify-between">
                                <label for="tmi" class="block text-sm font-medium text-slate-700">Tranche Marginale d'Imposition (%)</label>
                                <div data-tooltip="Votre taux d'imposition le plus √©lev√© (0, 11, 30, 41 ou 45%). Les revenus locatifs sont ajout√©s √† vos autres revenus et impos√©s √† ce taux."></div>
                            </div>
                            <select id="tmi" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="0">0 %</option>
                                <option value="11">11 %</option>
                                <option value="30" selected>30 %</option>
                                <option value="41">41 %</option>
                                <option value="45">45 %</option>
                            </select>
                        </div>


                        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Param√®tres d'√âvolution</h3>
                         <div>
                            <div class="flex items-center justify-between">
                                <label for="appreciation-rate" class="block text-sm font-medium text-slate-700">Revalorisation annuelle du lot (%)</label>
                                <div data-tooltip="Estimation de l'augmentation annuelle de la valeur du bien. Une moyenne se situe entre 1% et 2%."></div>
                            </div>
                            <input type="number" id="appreciation-rate" value="1" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <div>
                             <div class="flex items-center justify-between">
                                <label for="rent-increase-rate" class="block text-sm font-medium text-slate-700">Revalorisation annuelle loyers (%)</label>
                                <div data-tooltip="Augmentation annuelle des loyers, souvent bas√©e sur l'indice IRL (environ 2% en moyenne)."></div>
                            </div>
                            <input type="number" id="rent-increase-rate" value="2" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <div>
                            <div class="flex items-center justify-between">
                                <label for="charges-increase-rate" class="block text-sm font-medium text-slate-700">Revalorisation annuelle charges (%)</label>
                                <div data-tooltip="Augmentation annuelle des charges (copropri√©t√©, PNO, taxe fonci√®re)."></div>
                            </div>
                            <input type="number" id="charges-increase-rate" value="1.5" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>

                        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Param√®tres du Financement</h3>
                         <div class="space-y-2">
                             <div class="flex items-center justify-between">
                                <label for="notary-fees" class="block text-sm font-medium text-slate-700">Frais de notaire (‚Ç¨)</label>
                                <div data-tooltip="Calcul√©s automatiquement √† 12% du prix n√©goci√© (taux courant pour les parkings), ou saisissables manuellement."></div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span></span>
                                <div class="flex items-center">
                                    <span class="text-xs text-slate-500 mr-2">Manuelle</span>
                                    <label for="toggle-notary-fees" class="inline-flex relative items-center cursor-pointer">
                                        <input type="checkbox" value="" id="toggle-notary-fees" class="sr-only peer">
                                        <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                            <input type="text" id="notary-fees" placeholder="Calcul√© √† 12%" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500 transition" disabled>
                        </div>
                         <div>
                            <div class="flex items-center justify-between">
                                <label for="personal-contribution" class="block text-sm font-medium text-slate-700">Apport personnel (‚Ç¨)</label>
                                <div data-tooltip="Montant que vous financez sans emprunter. L'apport couvre g√©n√©ralement au minimum les frais de notaire."></div>
                            </div>
                            <input type="text" id="personal-contribution" value="0" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                         <div class="space-y-2">
                             <div class="flex items-center justify-between">
                                <label for="loan-rate" class="block text-sm font-medium text-slate-700">Taux du cr√©dit (%)</label>
                                <div data-tooltip="Taux d'int√©r√™t annuel du pr√™t. Taux national le plus bas (Cafpi.fr) mis √† jour automatiquement."></div>
                            </div>
                             <div class="flex items-center justify-between">
                                <span></span>
                                <div class="flex items-center">
                                    <span id="loan-rate-status" class="text-xs text-slate-500 mr-2"></span>
                                    <label for="toggle-loan-rate" class="inline-flex relative items-center cursor-pointer">
                                        <input type="checkbox" value="" id="toggle-loan-rate" class="sr-only peer">
                                        <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                            <input type="number" id="loan-rate" value="3.10" step="0.01" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500" disabled>
                        </div>
                        <div>
                            <div class="flex items-center justify-between">
                                <label for="loan-insurance-rate" class="block text-sm font-medium text-slate-700">Taux d'assurance cr√©dit (%)</label>
                                <div data-tooltip="Taux annuel de l'assurance emprunteur, calcul√© sur le montant total emprunt√©."></div>
                            </div>
                            <input type="number" id="loan-insurance-rate" value="0.35" step="0.01" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <div>
                            <div class="flex items-center justify-between">
                                <label for="loan-duration" class="block text-sm font-medium text-slate-700">Dur√©e du cr√©dit (ann√©es)</label>
                                <div data-tooltip="Dur√©e totale de remboursement du pr√™t."></div>
                            </div>
                            <select id="loan-duration" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                <option value="10">10 ans</option>
                                <option value="15">15 ans</option>
                                <option value="20">20 ans</option>
                                <option value="25" selected>25 ans</option>
                            </select>
                        </div>

                        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Charges Annuelles & Mensuelles</h3>
                        <div>
                            <div class="flex items-center justify-between">
                                <label for="pno-insurance" class="block text-sm font-medium text-slate-700">Assurance PNO annuelle / place (‚Ç¨)</label>
                                <div data-tooltip="Assurance Propri√©taire Non Occupant. Obligatoire pour un bien en location."></div>
                            </div>
                            <input type="number" id="pno-insurance" value="30" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                         <div>
                            <div class="flex items-center justify-between">
                                <label for="co-ownership-charges" class="block text-sm font-medium text-slate-700">Charges copro. mensuelles / place (‚Ç¨)</label>
                                <div data-tooltip="Charges de copropri√©t√© non r√©cup√©rables sur le locataire (ex: honoraires du syndic, entretien des parties communes)."></div>
                            </div>
                            <input type="number" id="co-ownership-charges" value="10" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <div class="space-y-2 pt-2">
                             <div class="flex items-center justify-between">
                                <label for="property-tax" class="block text-sm font-medium text-slate-700">Taxe fonci√®re annuelle (‚Ç¨)</label>
                                <div data-tooltip="Calcul√©e par d√©faut sur la base d'un mois de loyer total, ou saisissable manuellement."></div>
                            </div>
                             <div class="flex items-center justify-between">
                                <span></span>
                                <div class="flex items-center">
                                    <span class="text-xs text-slate-500 mr-2">Manuelle</span>
                                    <label for="toggle-property-tax" class="inline-flex relative items-center cursor-pointer">
                                        <input type="checkbox" value="" id="toggle-property-tax" class="sr-only peer">
                                        <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                            <input type="text" id="property-tax" placeholder="Calcul√©e sur 1 mois de loyer" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500 transition" disabled>
                        </div>
                        
                        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">‚ö°Ô∏è Option : √âlectrification des Places</h3>
                        <div>
                            <div class="flex items-center justify-between">
                                <label for="electrification-cost-per-space" class="block text-sm font-medium text-slate-700">Co√ªt des travaux / place (‚Ç¨)</label>
                                <div data-tooltip="Co√ªt d'installation d'une borne de recharge par place. Peut √™tre financ√© par l'emprunt."></div>
                            </div>
                            <input type="text" id="electrification-cost-per-space" placeholder="ex: 1 500" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                         <div>
                            <div class="flex items-center justify-between">
                                <label for="electrification-spaces-count" class="block text-sm font-medium text-slate-700">Nombre de places √† √©lectrifier</label>
                            </div>
                            <select id="electrification-spaces-count" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500"></select>
                        </div>
                         <div>
                             <div class="flex items-center justify-between">
                                <label for="electrification-year" class="block text-sm font-medium text-slate-700">Ann√©e de r√©alisation des travaux</label>
                            </div>
                            <input type="number" id="electrification-year" value="1" min="1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <div>
                             <div class="flex items-center justify-between">
                                <label for="new-rent-per-space" class="block text-sm font-medium text-slate-700">Nouveau loyer / place √©lectrifi√©e (‚Ç¨)</label>
                                <div data-tooltip="Le nouveau loyer (CC) pour les places qui seront √©quip√©es d'une borne."></div>
                            </div>
                            <input type="number" id="new-rent-per-space" placeholder="ex: 100" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>

                        <div class="pt-4 space-y-2">
                            <div class="flex space-x-2">
                                <button type="button" id="calculate-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-300 shadow-md">Calculer</button>
                                <button type="button" id="save-btn" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition duration-300 shadow-md">Sauvegarder</button>
                            </div>
                            <div>
                                 <button type="button" id="new-sim-btn" class="w-full bg-slate-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-600 transition duration-300 shadow-md">Nouvelle simulation</button>
                            </div>
                        </div>
                    </form>
    </div>
    
<div id="form-logement-wrapper" class="hidden">
    <h2 class="text-xl font-bold mb-6 border-b pb-3">Investissement Logement</h2>
    <form id="investment-form-logement" class="space-y-4">
         <div><div class="flex items-center justify-between"><label for="logement-city-name" class="block text-sm font-medium text-slate-700">Nom de la Ville</label><div data-tooltip="Nom de la ville o√π se situe le bien."></div></div><input type="text" id="logement-city-name" value="Lyon" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500"></div>
         <div><div class="flex items-center justify-between"><label for="logement-announcement-link" class="block text-sm font-medium text-slate-700">Lien de l'annonce</label><div data-tooltip="Optionnel : collez ici le lien de l'annonce."></div></div><input type="url" id="logement-announcement-link" placeholder="https://..." class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500"></div>
        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">D√©tails du bien</h3>
        <div><div class="flex items-center justify-between"><label for="logement-purchase-price" class="block text-sm font-medium text-slate-700">Prix affich√© du bien (‚Ç¨)</label></div><input type="text" id="logement-purchase-price" value="200000" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="logement-agency-fees" class="block text-sm font-medium text-slate-700">Frais d'agence (%)</label></div><input type="number" id="logement-agency-fees" value="4" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="logement-negotiation-rate" class="block text-sm font-medium text-slate-700">N√©gociation sur le prix (%)</label></div><input type="number" id="logement-negotiation-rate" value="3" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="logement-surface" class="block text-sm font-medium text-slate-700">Surface (m¬≤)</label></div><input type="number" id="logement-surface" value="50" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="logement-works-cost" class="block text-sm font-medium text-slate-700">Co√ªt des travaux (‚Ç¨)</label></div><input type="text" id="logement-works-cost" value="10000" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Revenus Locatifs</h3>
        <div><div class="flex items-center justify-between"><label for="logement-monthly-rent-hc" class="block text-sm font-medium text-slate-700">Loyer mensuel Hors Charges (‚Ç¨)</label></div><input type="number" id="logement-monthly-rent-hc" value="850" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="logement-monthly-charges" class="block text-sm font-medium text-slate-700">Charges locatives mensuelles (‚Ç¨)</label></div><input type="number" id="logement-monthly-charges" value="60" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="logement-vacancy-rate" class="block text-sm font-medium text-slate-700">Taux de vacance locative (%)</label><div data-tooltip="8% ‚âà 1 mois de loyer."></div></div><input type="number" id="logement-vacancy-rate" value="8" step="0.5" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Fiscalit√©</h3>
        <div><div class="flex items-center justify-between"><label for="logement-tax-regime" class="block text-sm font-medium text-slate-700">R√©gime d'imposition</label></div><select id="logement-tax-regime" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"><option value="none">Pas d'imposition</option><option value="micro">Micro-BIC (LMNP)</option><option value="reel" selected>R√©gime R√©el (LMNP)</option></select></div>
        <div><div class="flex items-center justify-between"><label for="logement-tmi" class="block text-sm font-medium text-slate-700">TMI (%)</label></div><select id="logement-tmi" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"><option value="0">0 %</option><option value="11">11 %</option><option value="30" selected>30 %</option><option value="41">41 %</option><option value="45">45 %</option></select></div>
        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Param√®tres d'√âvolution</h3>
        <div><div class="flex items-center justify-between"><label for="logement-appreciation-rate" class="block text-sm font-medium text-slate-700">Revalorisation annuelle du bien (%)</label></div><input type="number" id="logement-appreciation-rate" value="1.5" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="logement-rent-increase-rate" class="block text-sm font-medium text-slate-700">Revalorisation annuelle loyers (%)</label></div><input type="number" id="logement-rent-increase-rate" value="2" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="logement-charges-increase-rate" class="block text-sm font-medium text-slate-700">Revalorisation annuelle charges (%)</label></div><input type="number" id="logement-charges-increase-rate" value="1.5" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Param√®tres du Financement</h3>
        <div class="space-y-2"><div class="flex items-center justify-between"><label for="logement-notary-fees" class="block text-sm font-medium text-slate-700">Frais de notaire (‚Ç¨)</label><div data-tooltip="Calcul√©s √† 8% du prix n√©goci√©."></div></div><div class="flex items-center justify-between"><span></span><div class="flex items-center"><span class="text-xs text-slate-500 mr-2">Manuelle</span><label for="logement-toggle-notary-fees" class="inline-flex relative items-center cursor-pointer"><input type="checkbox" id="logement-toggle-notary-fees" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div></label></div></div><input type="text" id="logement-notary-fees" placeholder="Calcul√© √† 8%" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm" disabled></div>
        <div><div class="flex items-center justify-between"><label for="logement-personal-contribution" class="block text-sm font-medium text-slate-700">Apport personnel (‚Ç¨)</label></div><input type="text" id="logement-personal-contribution" value="16000" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div class="space-y-2"><div class="flex items-center justify-between"><label for="logement-loan-rate" class="block text-sm font-medium text-slate-700">Taux du cr√©dit (%)</label></div><div class="flex items-center justify-between"><span></span><div class="flex items-center"><span id="logement-loan-rate-status" class="text-xs text-slate-500 mr-2">Auto</span><label class="inline-flex relative items-center cursor-pointer"><input type="checkbox" id="logement-toggle-loan-rate" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div></label></div></div><input type="number" id="logement-loan-rate" value="3.15" step="0.01" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm" disabled></div>
        <div><div class="flex items-center justify-between"><label for="logement-loan-insurance-rate" class="block text-sm font-medium text-slate-700">Taux d'assurance cr√©dit (%)</label></div><input type="number" id="logement-loan-insurance-rate" value="0.35" step="0.01" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="logement-loan-duration" class="block text-sm font-medium text-slate-700">Dur√©e du cr√©dit (ann√©es)</label></div><select id="logement-loan-duration" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"><option value="10">10 ans</option><option value="15">15 ans</option><option value="20" selected>20 ans</option><option value="25">25 ans</option></select></div>
        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Charges Annuelles</h3>
        <div><div class="flex items-center justify-between"><label for="logement-property-tax" class="block text-sm font-medium text-slate-700">Taxe fonci√®re (‚Ç¨)</label></div><input type="text" id="logement-property-tax" value="800" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="logement-co-ownership-charges" class="block text-sm font-medium text-slate-700">Charges copro. non r√©cup√©rables (‚Ç¨)</label></div><input type="number" id="logement-co-ownership-charges" value="400" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="logement-pno-insurance" class="block text-sm font-medium text-slate-700">Assurance PNO (‚Ç¨)</label></div><input type="number" id="logement-pno-insurance" value="120" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="logement-management-fees" class="block text-sm font-medium text-slate-700">Frais de gestion locative (%)</label><div data-tooltip="Mettre 0 si vous g√©rez vous-m√™me."></div></div><input type="number" id="logement-management-fees" value="7" step="0.5" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
         <div class="pt-4 space-y-2"><div class="flex space-x-2"><button type="button" class="btn-calculate w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition">Calculer</button><button type="button" class="btn-save w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition">Sauvegarder</button></div><div><button type="button" class="btn-new w-full bg-slate-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-600 transition">Nouvelle simulation</button></div></div>
    </form>
</div>
    
<div id="form-cave-wrapper" class="hidden">
    <h2 class="text-xl font-bold mb-6 border-b pb-3">Investissement Cave / Box</h2>
    <form id="investment-form-cave" class="space-y-4">
         <div><div class="flex items-center justify-between"><label for="cave-city-name" class="block text-sm font-medium text-slate-700">Nom de la Ville</label><div data-tooltip="Nom de la ville o√π se situe le bien."></div></div><input type="text" id="cave-city-name" value="Bordeaux" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
         <div><div class="flex items-center justify-between"><label for="cave-announcement-link" class="block text-sm font-medium text-slate-700">Lien de l'annonce</label><div data-tooltip="Optionnel : collez ici le lien de l'annonce."></div></div><input type="url" id="cave-announcement-link" placeholder="https://..." class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">D√©tails du bien</h3>
        <div><div class="flex items-center justify-between"><label for="cave-purchase-price" class="block text-sm font-medium text-slate-700">Prix affich√© du lot (‚Ç¨)</label></div><input type="text" id="cave-purchase-price" value="30000" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="cave-negotiation-rate" class="block text-sm font-medium text-slate-700">N√©gociation sur le prix (%)</label></div><input type="number" id="cave-negotiation-rate" value="7" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="cave-count" class="block text-sm font-medium text-slate-700">Nombre de caves / box</label></div><input type="number" id="cave-count" value="10" min="1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="cave-rent-per-unit" class="block text-sm font-medium text-slate-700">Loyer mensuel / unit√© (‚Ç¨)</label></div><input type="number" id="cave-rent-per-unit" value="45" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Fiscalit√©</h3>
        <div><div class="flex items-center justify-between"><label for="cave-tax-regime" class="block text-sm font-medium text-slate-700">R√©gime d'imposition</label></div><select id="cave-tax-regime" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"><option value="none">Pas d'imposition</option><option value="micro" selected>Micro-BIC</option><option value="reel">R√©gime R√©el</option></select></div>
        <div><div class="flex items-center justify-between"><label for="cave-tmi" class="block text-sm font-medium text-slate-700">TMI (%)</label></div><select id="cave-tmi" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"><option value="0">0 %</option><option value="11">11 %</option><option value="30" selected>30 %</option><option value="41">41 %</option><option value="45">45 %</option></select></div>
        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Param√®tres d'√âvolution</h3>
        <div><div class="flex items-center justify-between"><label for="cave-appreciation-rate" class="block text-sm font-medium text-slate-700">Revalorisation annuelle du lot (%)</label></div><input type="number" id="cave-appreciation-rate" value="1" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="cave-rent-increase-rate" class="block text-sm font-medium text-slate-700">Revalorisation annuelle loyers (%)</label></div><input type="number" id="cave-rent-increase-rate" value="2" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="cave-charges-increase-rate" class="block text-sm font-medium text-slate-700">Revalorisation annuelle charges (%)</label></div><input type="number" id="cave-charges-increase-rate" value="1.5" step="0.1" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Param√®tres du Financement</h3>
        <div class="space-y-2"><div class="flex items-center justify-between"><label for="cave-notary-fees" class="block text-sm font-medium text-slate-700">Frais de notaire (‚Ç¨)</label><div data-tooltip="Calcul√©s √† 15% du prix n√©goci√©."></div></div><div class="flex items-center justify-between"><span></span><div class="flex items-center"><span class="text-xs text-slate-500 mr-2">Manuelle</span><label for="cave-toggle-notary-fees" class="inline-flex relative items-center cursor-pointer"><input type="checkbox" id="cave-toggle-notary-fees" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div></label></div></div><input type="text" id="cave-notary-fees" placeholder="Calcul√© √† 15%" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm" disabled></div>
        <div><div class="flex items-center justify-between"><label for="cave-personal-contribution" class="block text-sm font-medium text-slate-700">Apport personnel (‚Ç¨)</label></div><input type="text" id="cave-personal-contribution" value="0" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div class="space-y-2"><div class="flex items-center justify-between"><label for="cave-loan-rate" class="block text-sm font-medium text-slate-700">Taux du cr√©dit (%)</label></div><div class="flex items-center justify-between"><span></span><div class="flex items-center"><span id="cave-loan-rate-status" class="text-xs text-slate-500 mr-2">Auto</span><label class="inline-flex relative items-center cursor-pointer"><input type="checkbox" id="cave-toggle-loan-rate" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div></label></div></div><input type="number" id="cave-loan-rate" value="3.15" step="0.01" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm" disabled></div>
        <div><div class="flex items-center justify-between"><label for="cave-loan-insurance-rate" class="block text-sm font-medium text-slate-700">Taux d'assurance cr√©dit (%)</label></div><input type="number" id="cave-loan-insurance-rate" value="0.35" step="0.01" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="cave-loan-duration" class="block text-sm font-medium text-slate-700">Dur√©e du cr√©dit (ann√©es)</label></div><select id="cave-loan-duration" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"><option value="10">10 ans</option><option value="15" selected>15 ans</option><option value="20">20 ans</option><option value="25">25 ans</option></select></div>
        <h3 class="text-lg font-semibold pt-4 mt-4 border-t">Charges Annuelles</h3>
        <div class="space-y-2 pt-2"><div class="flex items-center justify-between"><label for="cave-property-tax" class="block text-sm font-medium text-slate-700">Taxe fonci√®re (‚Ç¨)</label><div data-tooltip="Calcul√©e sur 1 mois de loyer total."></div></div><div class="flex items-center justify-between"><span></span><div class="flex items-center"><span class="text-xs text-slate-500 mr-2">Manuelle</span><label for="cave-toggle-property-tax" class="inline-flex relative items-center cursor-pointer"><input type="checkbox" id="cave-toggle-property-tax" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div></label></div></div><input type="text" id="cave-property-tax" placeholder="Calcul√©e sur 1 mois de loyer" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm" disabled></div>
        <div><div class="flex items-center justify-between"><label for="cave-co-ownership-charges" class="block text-sm font-medium text-slate-700">Charges copro. mensuelles / unit√© (‚Ç¨)</label></div><input type="number" id="cave-co-ownership-charges" value="5" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div><div class="flex items-center justify-between"><label for="cave-pno-insurance" class="block text-sm font-medium text-slate-700">Assurance PNO annuelle / unit√© (‚Ç¨)</label></div><input type="number" id="cave-pno-insurance" value="15" class="mt-1 block w-full bg-slate-100 border-transparent rounded-lg shadow-sm"></div>
        <div class="pt-4 space-y-2"><div class="flex space-x-2"><button type="button" class="btn-calculate w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition">Calculer</button><button type="button" class="btn-save w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition">Sauvegarder</button></div><div><button type="button" class="btn-new w-full bg-slate-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-600 transition">Nouvelle simulation</button></div></div>
    </form>
</div>
                <div class="md:col-span-1 bg-white p-6 rounded-2xl shadow-lg self-start no-print">

                </div>

                <div id="results-section" class="md:col-span-2 space-y-6" style="display: none;">
                    <div class="no-print text-right">
                        <button type="button" id="print-btn" class="bg-gray-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-800 transition duration-300 shadow-md inline-flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v6a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd"></path></svg>
                            Imprimer (PDF)
                        </button>
                    </div>
                     <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h2 class="text-xl font-bold mb-4">Synth√®se du Financement</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                             <div class="bg-slate-100 p-4 rounded-lg">
                                <p class="text-sm text-slate-600">Co√ªt total du projet</p>
                                <p id="total-project-cost" class="text-2xl font-semibold"></p>
                                 <p class="text-xs text-slate-500">(Achat + Notaire + Travaux)</p>
                            </div>
                            <div class="bg-slate-100 p-4 rounded-lg">
                                <p class="text-sm text-slate-600">Montant total √† emprunter</p>
                                <p id="total-loan" class="text-2xl font-semibold"></p>
                            </div>
                            <div class="bg-slate-100 p-4 rounded-lg">
                                <p class="text-sm text-slate-600">Mensualit√© du cr√©dit</p>
                                <p id="monthly-payment" class="text-2xl font-semibold"></p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h2 class="text-xl font-bold mb-4">Analyse du Cash Flow (Ann√©e 1)</h2>
                         <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
                            <div class="bg-green-50 p-3 rounded-lg text-center">
                                <p class="text-sm text-green-800">Revenus Mensuels</p>
                                <p id="monthly-income" class="text-lg font-bold text-green-900"></p>
                            </div>
                            <div class="bg-red-50 p-3 rounded-lg text-center">
                                <p class="text-sm text-red-800">D√©penses Mensuelles</p>
                                <p id="monthly-expenses" class="text-lg font-bold text-red-900"></p>
                            </div>
                             <div class="bg-red-100 p-3 rounded-lg text-center">
                                <p class="text-sm text-red-800">Imp√¥t sur le Revenu /m</p>
                                <p id="monthly-tax" class="text-lg font-bold text-red-900"></p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-center mt-6">
                            <div id="monthly-cf-card" class="result-card p-4 rounded-lg">
                                <p class="text-sm">Cash Flow Net Mensuel</p>
                                <p id="monthly-cashflow" class="text-3xl font-bold"></p>
                            </div>
                            <div id="annual-cf-card" class="result-card p-4 rounded-lg">
                                <p class="text-sm">Cash Flow Net Annuel</p>
                                <p id="annual-cashflow" class="text-3xl font-bold"></p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h2 class="text-xl font-bold mb-4">√âvolution Annuelle du Cash Flow</h2>
                        <div class="overflow-x-auto max-h-[400px] printable-table-container">
                            <table class="w-full text-sm text-left text-slate-500">
                                <thead class="text-xs text-slate-700 uppercase bg-slate-100 sticky top-0">
                                    <tr>
                                        <th class="px-2 py-3 rounded-l-lg">An</th>
                                        <th class="px-2 py-3">Revenus</th>
                                        <th class="px-2 py-3">CF Brut</th>
                                        <th class="px-2 py-3">Imp√¥t</th>
                                        <th class="px-2 py-3">CF Net</th>
                                        <th class="px-2 py-3 rounded-r-lg">CF Net /m</th>
                                    </tr>
                                </thead>
                                <tbody id="cashflow-evolution-table"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h2 class="text-xl font-bold mb-4">Analyse de la Revente et Plus-Value</h2>
                        <div class="overflow-x-auto max-h-[400px] printable-table-container">
                            <table class="w-full text-sm text-left text-slate-500">
                                <thead class="text-xs text-slate-700 uppercase bg-slate-100 sticky top-0">
                                    <tr>
                                        <th class="px-4 py-3 rounded-l-lg">Ann√©e</th>
                                        <th class="px-4 py-3">Valeur du Lot</th>
                                        <th class="px-4 py-3">Plus-Value Nette</th>
                                        <th class="px-4 py-3 rounded-r-lg">PV Nette (%)</th>
                                    </tr>
                                </thead>
                                <tbody id="resale-analysis-table"></tbody>
                            </table>
                        </div>
                    </div>
                     <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h2 id="final-balance-title" class="text-xl font-bold mb-4">Bilan Final de l'Op√©ration</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-center">
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <p class="text-sm text-slate-600">Total des Cash Flows Nets cumul√©s</p>
                                <p id="total-cashflow" class="text-2xl font-semibold"></p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <p class="text-sm text-slate-600">Plus-Value Nette √† la revente</p>
                                <p id="final-net-gain" class="text-2xl font-semibold"></p>
                            </div>
                        </div>
                        <div class="mt-4 bg-blue-50 p-4 rounded-lg text-center">
                             <p class="text-sm text-blue-800">B√©n√©fice Total de l'Op√©ration (‚Ç¨)</p>
                             <p id="total-profit-euros" class="text-3xl font-bold text-blue-900"></p>
                        </div>
                         <div class="mt-4 bg-blue-50 p-4 rounded-lg text-center">
                             <p class="text-sm text-blue-800">B√©n√©fice Total de l'Op√©ration (%)</p>
                             <p id="total-profit-percent" class="text-3xl font-bold text-blue-900"></p>
                             <p class="text-xs text-slate-500">(par rapport au co√ªt total d'acquisition)</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg border-2 border-blue-500">
                        <h2 id="final-balance-title-30" class="text-xl font-bold mb-4 text-blue-700">Bilan Final de l'Op√©ration (Vente √† 30 ans)</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-center">
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <p class="text-sm text-slate-600">Total des Cash Flows Nets cumul√©s</p>
                                <p id="total-cashflow-30" class="text-2xl font-semibold"></p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <p class="text-sm text-slate-600">Plus-Value Nette √† la revente</p>
                                <p id="final-net-gain-30" class="text-2xl font-semibold"></p>
                            </div>
                        </div>
                        <div class="mt-4 bg-blue-50 p-4 rounded-lg text-center">
                             <p class="text-sm text-blue-800">B√©n√©fice Total de l'Op√©ration (‚Ç¨)</p>
                             <p id="total-profit-euros-30" class="text-3xl font-bold text-blue-900"></p>
                        </div>
                         <div class="mt-4 bg-blue-50 p-4 rounded-lg text-center">
                             <p class="text-sm text-blue-800">B√©n√©fice Total de l'Op√©ration (%)</p>
                             <p id="total-profit-percent-30" class="text-3xl font-bold text-blue-900"></p>
                             <p class="text-xs text-slate-500">(par rapport au co√ªt total d'acquisition)</p>
                        </div>
                    </div>
                </div>
            </main>
            <section id="saved-simulations-section" class="mt-12 no-print">
                 <div class="flex flex-wrap items-center justify-between mb-6 border-b pb-3">
                    <h2 class="text-2xl font-bold text-slate-900">Mes Simulations</h2>
                    <div id="sort-controls" class="flex items-center gap-2 sm:gap-4">
                        <span class="text-sm font-medium text-slate-700 hidden sm:block">Trier par:</span>
                        <button data-sort="date" class="sort-btn text-sm bg-slate-200 hover:bg-slate-300 text-slate-800 font-semibold py-2 px-3 rounded-lg transition active">Date</button>
                        <button data-sort="name" class="sort-btn text-sm bg-slate-200 hover:bg-slate-300 text-slate-800 font-semibold py-2 px-3 rounded-lg transition">Nom</button>
                        <button data-sort="investment" class="sort-btn text-sm bg-slate-200 hover:bg-slate-300 text-slate-800 font-semibold py-2 px-3 rounded-lg transition">Investissement</button>
                        <button data-sort="profit" class="sort-btn text-sm bg-slate-200 hover:bg-slate-300 text-slate-800 font-semibold py-2 px-3 rounded-lg transition">B√©n√©fice %</button>
                    </div>
                </div>
                <div id="simulations-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                 <p id="no-simulations-message" class="text-slate-500 bg-white p-6 rounded-2xl shadow text-center">Aucune simulation sauvegard√©e.</p>
            </section>
            <section id="top-investments-section" class="mt-12 no-print">
                <h2 class="text-2xl font-bold text-slate-900 mb-6 border-b pb-3">üèÜ Top 3 des Investissements</h2>
                <div id="top-investments-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                <p id="not-enough-simulations-message" class="text-slate-500 bg-white p-6 rounded-2xl shadow text-center" style="display: none;">Sauvegardez au moins une simulation pour voir le classement.</p>
            </section>
		</div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyB4780iRxAhvjUUi-FHf08dXvlOMNWFWe0",
        authDomain: "simulateur-parking-app.firebaseapp.com",
        projectId: "simulateur-parking-app",
        storageBucket: "simulateur-parking-app.firebasestorage.app",
        messagingSenderId: "5729529939",
        appId: "1:5729529939:web:c4af96400a826998ab16a6"
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();
      
      let currentUser = null;
      let allUserSimulations = [];
      let unsubscribeSimulations = null;
      let currentInvestmentType = null;

      // --- UTILITY FUNCTIONS ---
      const formatCurrency = (value) => new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(value);
      const formatPercent = (value) => `${(value || 0).toFixed(2)} %`;
      const parseFormattedNumber = (str) => parseFloat(String(str).replace(/\s/g, '').replace(',', '.')) || 0;

      const toggleUI = (toggle, input, placeholderEnabled, placeholderDisabled) => {
            input.disabled = !toggle.checked;
            if(placeholderEnabled !== null) input.placeholder = toggle.checked ? placeholderEnabled : placeholderDisabled;
      };

      // --- TAX CALCULATION LOGIC ---
      function calculateTaxes(annualIncome, annualCharges, annualLoanInterest, taxRegime, tmiRate) {
            if (taxRegime === 'none' || tmiRate === 0) return 0;
            const socialContributionsRate = 0.172;
            const tmi = tmiRate / 100;
            let taxableBase = 0;
            if (taxRegime === 'micro') { taxableBase = annualIncome * 0.50; } 
            else if (taxRegime === 'reel') { taxableBase = annualIncome - (annualCharges + annualLoanInterest); }
            if (taxableBase <= 0) return 0;
            return taxableBase * (tmi + socialContributionsRate);
      }

      function calculateCapitalGainsTax(grossGain, holdingYear) {
             if (grossGain <= 0) return { tax: 0, netGain: grossGain };
            const INCOME_TAX_RATE = 0.19, SOCIAL_TAX_RATE = 0.172;
            let incomeTaxAllowanceRate = 0;
            if (holdingYear > 5) {
                if (holdingYear <= 21) incomeTaxAllowanceRate = (holdingYear - 5) * 0.06;
                else if (holdingYear === 22) incomeTaxAllowanceRate = (16 * 0.06) + 0.04; 
                else incomeTaxAllowanceRate = 1; 
            }
            let socialTaxAllowanceRate = 0;
            if (holdingYear > 5) {
                if (holdingYear <= 21) socialTaxAllowanceRate = (holdingYear - 5) * 0.0165;
                else if (holdingYear === 22) socialTaxAllowanceRate = (16 * 0.0165) + 0.0160;
                else if (holdingYear <= 30) socialTaxAllowanceRate = (16 * 0.0165) + 0.0160 + ((holdingYear - 22) * 0.09);
                else socialTaxAllowanceRate = 1; 
            }
            const taxableIncomeBase = grossGain * (1 - incomeTaxAllowanceRate);
            const taxableSocialBase = grossGain * (1 - socialTaxAllowanceRate);
            const totalTax = (taxableIncomeBase * INCOME_TAX_RATE) + (taxableSocialBase * SOCIAL_TAX_RATE);
            return { tax: totalTax, netGain: grossGain - totalTax };
      }

      // --- DOM ELEMENTS & FORMS ---
      const formElements = {
          parking: {
              form: document.getElementById('investment-form-parking'),
              // ... Add all parking form element IDs here
          },
          logement: {
              form: document.getElementById('investment-form-logement'),
              // ... Add all logement form element IDs here
          },
          cave: {
              form: document.getElementById('investment-form-cave'),
              // ... Add all cave form element IDs here
          }
      };
      
      // --- SIMULATION ROUTER ---
      function runSimulation() {
          if (!currentInvestmentType) return;
          switch(currentInvestmentType) {
              case 'parking': return runParkingSimulation();
              case 'logement': return runLogementSimulation();
              case 'cave': return runCaveSimulation();
          }
      }

      // --- All other simulation, navigation, and data functions will go here ---

    </script>
</body>
</html>   